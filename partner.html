<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zyada Partner Pickup</title>
  <style>
    :root { --border:#e2e8f0; --muted:#64748b; --ink:#0f172a; --emerald:#22c55e; --red:#ef4444; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Inter, Arial; color:var(--ink); }
    .wrap { max-width:720px; margin:0 auto; padding:20px 16px }
    h1 { font-size:20px; margin:0 0 8px; }
    .card { border:1px solid var(--border); border-radius:14px; padding:16px; }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center }
    .input { padding:12px; border:1px solid var(--border); border-radius:12px; width:100%; max-width:320px }
    .btn { padding:12px 16px; border-radius:12px; border:1px solid var(--border); background:#fff; cursor:pointer; font-weight:700 }
    .btn.primary { background:var(--emerald); color:#fff; border-color:var(--emerald) }
    .btn.danger { background:var(--red); color:#fff; border-color:var(--red) }
    .note { color:var(--muted); font-size:12px }
    .result { margin-top:12px; border:1px dashed var(--border); padding:10px; border-radius:12px }
    .ok { color:#065f46 }
    .err { color:#b91c1c }
    .grid { display:grid; gap:12px }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Zyada Partner Pickup</h1>
    <div class="card grid">
      <div class="row">
        <input id="code" class="input" placeholder="Enter Pickup Code (6 digits)" inputmode="numeric" />
        <input id="offer" class="input" placeholder="OfferId (optional)" />
      </div>
      <div class="row">
        <button class="btn primary" id="redeem">Mark as Picked Up</button>
        <button class="btn" id="lookup">Lookup Reservation</button>
      </div>
      <div id="out" class="result note">Result will appear here.</div>
    </div>
    <p class="note">Tip: Keep this page open at the counter. Enter the 6â€‘digit code the customer shows.</p>
  </div>
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzw1_ZTMPCKgX9rUf38LxfNU2kD_cNGoGveeti-1XAy2IhpQR-SFF1TyIpDpqdtfZeUNg/exec";

    document.getElementById('redeem').addEventListener('click', async () => {
      const code = document.getElementById('code').value.trim();
      const offerId = document.getElementById('offer').value.trim();
      if (!/^\d{6}$/.test(code)) return show('Please enter a valid 6â€‘digit code.', true);
      try {
        const res = await fetch(API_URL + '?route=redeem', {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ pickupCode: code, offerId })
        });
        const j = await res.json();
        if (j.ok) show('âœ… Picked up. Reservation ' + j.ReservationId + ' â€¢ Offer ' + (j.OfferId||'') + ' â€¢ at ' + j.RedeemedAt, false);
        else show('âŒ ' + (j.reason || 'Could not redeem'), true);
      } catch (e) { show('Network error', true); }
    });

    document.getElementById('lookup').addEventListener('click', async () => {
      const code = document.getElementById('code').value.trim();
      if (!/^\d{6}$/.test(code)) return show('Enter a 6â€‘digit code to look up.', true);
      try {
        const res = await fetch(API_URL + '?route=reservation&code=' + encodeURIComponent(code), { cache: 'no-store' });
        const j = await res.json();
        if (j && j.ReservationId) show('ðŸ”Ž Reservation ' + j.ReservationId + ' â€¢ Offer ' + (j.OfferId||'') + ' â€¢ Status ' + (j.Status||''), false);
        else show('Not found', true);
      } catch (e) { show('Network error', true); }
    });

    function show(msg, isErr) {
      const out = document.getElementById('out');
      out.className = 'result note ' + (isErr ? 'err' : 'ok');
      out.textContent = msg;
    }
  </script>
</body>
</html>
