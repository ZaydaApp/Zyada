<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Zyada â€” Success</title>
<style>
  body{margin:0; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Arial; background:#f8fafc; color:#0f172a;}
  .wrap{ max-width:560px; margin:40px auto; background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:24px; }
  h1{ margin:0 0 8px 0; font-size:22px;}
  .code{ font-size:28px; font-weight:800; padding:12px 16px; background:#111827; color:#fff; border-radius:12px; letter-spacing:2px; display:inline-block; }
  .muted{ color:#64748b; }
  a.btn{ display:inline-block; margin-top:16px; padding:10px 14px; background:#22c55e; color:#fff; text-decoration:none; border-radius:10px; font-weight:700; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Payment confirmed ðŸŽ‰</h1>
    <p class="muted">Show this pickup code at the counter:</p>
    <div id="code" class="code">â€¢â€¢â€¢â€¢â€¢â€¢</div>
    <p class="muted" id="note"></p>
    <a class="btn" href="index.html">Back to offers</a>
  </div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwe5z-2jVkydKHN5fAKWHSx-wGdH8MF1_FTW4NtcpR7/dev'; // same /dev URL
function getParam(k){ return new URLSearchParams(location.search).get(k)||''; }
(async function(){
  const sid = getParam('sid');
  if(!sid){ document.getElementById('code').textContent='No session id'; return; }
  try{
    const r = await fetch(API_URL + '?route=finalize&sid=' + encodeURIComponent(sid));
    const out = await r.json();
    if(out && out.ok){
      document.getElementById('code').textContent = out.PickupCode || 'â€”';
      document.getElementById('note').textContent = 'Reservation ID: ' + (out.ReservationId||'');
    }else{
      document.getElementById('code').textContent = 'Not paid / try again';
      document.getElementById('note').textContent = out && out.error ? out.error : '';
    }
  }catch(e){
    document.getElementById('code').textContent='Network error';
  }
})();
</script>
</body>
</html>
