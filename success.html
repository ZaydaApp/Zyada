<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zyada ‚Äî Payment Success</title>
  <style>
    :root{--border:#e2e8f0;--ink:#0f172a;--muted:#64748b;--emerald:#22c55e}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Arial;color:var(--ink)}
    .wrap{max-width:560px;margin:40px auto;padding:0 16px}
    .card{border:1px solid var(--border);border-radius:16px;padding:18px;background:#fff}
    .chip{display:inline-flex;gap:6px;align-items:center;border:1px dashed var(--border);padding:10px 12px;border-radius:12px;font-family:ui-monospace,Menlo,monospace;font-weight:800;background:#f8fafc}
    .btn{padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--emerald);border-color:var(--emerald);color:#fff}
    .note{color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Payment successful üéâ</h2>
    <div class="card" id="box">Finalizing your reservation‚Ä¶</div>
    <div style="margin-top:12px">
      <a class="btn" href="index.html">Back to deals</a>
      <a class="btn primary" href="my.html">My reservation</a>
    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxWRZbl_GE-EFP41pd7i62hJojq3eUstWHtZwKGdqb25CZ60eQsN61vmirDr4owpI0MIQ/exec";
    (async ()=>{
      const box = document.getElementById('box');
      const params = new URLSearchParams(location.search);
      const sid = params.get('sid');
      if (!sid){ box.textContent = 'Missing session.'; return; }

      try{
        const r = await fetch(API_URL + '?route=finalize&sid=' + encodeURIComponent(sid), { cache:'no-store' });
        const out = await r.json();
        if (!out.ok) { box.textContent = 'Could not finalize: ' + (out.error||'unknown'); return; }
        box.innerHTML =
          '<div>Show this at pickup within 30 minutes:</div>'+
          '<div class="chip" style="margin:10px 0">Pickup code: <span id="code">'+(out.PickupCode||'')+'</span></div>'+
          '<button class="btn" id="copy">Copy code</button>'+
          '<div class="note" style="margin-top:8px">You can also view it later in ‚ÄúMy reservation‚Äù.</div>';
        document.getElementById('copy').onclick = ()=>{
          const t = document.getElementById('code').textContent||'';
          navigator.clipboard.writeText(t);
          alert('Copied!');
        };
      }catch(e){
        box.textContent = 'Network error.';
      }
    })();
  </script>
</body>
</html>
