<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zyada Debug</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Inter, Arial; margin: 24px; }
    .ok { color: #16a34a; font-weight: 700; }
    .err { color: #dc2626; font-weight: 700; }
    pre { background:#f8fafc; padding:12px; border-radius:8px; overflow:auto; border:1px solid #e2e8f0; }
    ul { line-height: 1.7; }
  </style>
</head>
<body>
  <h1>Debug — Offers fetch</h1>

  <p>JS boot: <span id="boot" class="err">not yet</span></p>
  <p>Health: <span id="health">–</span></p>
  <p>Offers count: <span id="count">–</span></p>

  <h3>First 5 offers</h3>
  <ul id="list"></ul>

  <h3>Raw JSON (truncated)</h3>
  <pre id="raw"></pre>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzNeNuyhUNhrd3QY0b3Vt8ktgBgZTkAsx74hQTXIoNNcmCQ8TNSOaMr4v20-KRbVSOlwg/exec";
    console.log("BOOT");
    document.getElementById('boot').textContent = 'OK';
    document.getElementById('boot').className = 'ok';

    (async () => {
      try {
        const h = await fetch(API_URL + '?route=health', { cache: 'no-store' });
        document.getElementById('health').textContent = (await h.text());
      } catch (e) {
        document.getElementById('health').textContent = 'failed';
      }

      try {
        const r = await fetch(API_URL + '?route=offers', { cache: 'no-store' });
        const data = await r.json();
        console.log('OFFERS JSON:', data);
        document.getElementById('count').textContent = Array.isArray(data) ? data.length : 'not array';
        const list = document.getElementById('list');
        list.innerHTML = '';
        (data.slice ? data.slice(0,5) : []).forEach(o => {
          const li = document.createElement('li');
          li.textContent = (o.ItemName || '(no ItemName)') + ' — ' + (o.PartnerName || o.OutletName || '(no Partner)') + ' — OfferId ' + (o.OfferId || '(none)');
          list.appendChild(li);
        });
        document.getElementById('raw').textContent = JSON.stringify(data, null, 2).slice(0, 4000);
      } catch (e) {
        document.getElementById('raw').textContent = 'Fetch or JSON parse failed: ' + e;
        document.getElementById('count').textContent = 'error';
      }
    })();
  </script>
</body>
</html>
